---
title: oce package for oceanographical data
author: Saskia
date: '2019-01-16'
slug: oce-package-for-oceanographical-data
categories:
  - data visualization
tags:
  - R package
  - oceanography
banner: "img/banners/oce_package.png"  
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, error=FALSE, 
	warning=FALSE, message=FALSE,
  fig.align = "center")
```

In this post I will present the [oce](https://cran.r-project.org/package=oce) package, which can be handy for marine data scientist working with **oceanographical data**. *oce* provides lots of functions to

- read oceanographic data,
- process the data specific to the measuring instrument, and 
- visualize results following oceanographic conventions (using the base graphics).

The key function for importing data into R is `?read.oce()`, which automatically recognizes the file type. If the recognition does not work, try the individual functions (e.g. `read.ctd()` for CTD files, `read.odf()` for ODF (Ocean Data Files) files, `read.netcdf()` for NetCDF files).

I won't go into much detail on all the functions provided (for this see the [reference manual](https://cran.r-project.org/web/packages/oce/oce.pdf) or `?oce` and then click on **index** at the bottom of the page). Instead, I will demonstrate you some plots you can create for specific datasets or purposes. The great advantage of this package is that you don't need to wrangle your data into the typical data frame format for visualization and that it can handle many formats generated by typical oceanographical instruments!

The package also comes with few datasets included, e.g.

- `ctd`
- `wind`
- `section` (a hydrographic section)
- `adp` (ADP (acoustic-doppler profiler) dataset)
- `echosounder` (a degraded subsample of measurements that were made with a Biosonics scientific echosounder, as part of the St Lawrence Internal Wave Experiment (SLEIWEX) )
- `landsat` (a sample from the landsat satellite dataset)
- `argo` (holds data from the argo float ARGO 6900388 in the North Atlantic; FYI: argo floats are robots that float at different depths in the sea collecting information)
- `lobo` (sample lobo dataset obtained in the Northwest Arm of Halifax by Satlantic; a lobo is a complete turn-key water quality monitoring system that addresses the need for routine, robust, and accurate measurements)
- `lisst` (data from a LISST instruments, which is an in-situ optical laser diffraction instrument to measure particle size and concentration of suspended sediments)

Most other dataset have now been outsourced into the data package [ocedata](https://cran.r-project.org/package=ocedata).
 
## Plot CTD data

Lets look first at the CTD data included (CTD stands for **C**onductivity, **T**emperature, and **D**epth) :
```{r, }
library(oce)
data(ctd)
ctd
summary(ctd)
```
This dataset is a CTD profile measured at Halifax Harbour in 2003. The R object is obviously not in a data frame format but if you use an  plotting function you don't need to convert it as you will see next.

When loading the oce package, you can use the generic `plot()`function, which automatically recognizes the data type and applies the respective plotting method. 
```{r, fig.cap="Four panels produced for CTD data."}
plot(ctd)
```

The plot method for CTD data automatically generates several panels. If you want to plot only a subset, use the `which` argument:

```{r, fig.cap="Only the temperature and salinity profile.", fig.align='center'}
plot(ctd, which = 1)
```

In the `which` argument you can provide a scalar or vector of desired plots. In fact, all plots that the package can produce have a number from 1 to 33, but not all can be generated with the same type of data. If the input data type is CTD, plot number 1,2,3, and 5 are produced (see also `?plot,ctd-method`):

```{r, eval=FALSE}
# same as plot(ctd):
plot(ctd, which = c(1,2,3,5))
```

The following would not make much sense or give an error:
```{r, eval=FALSE}
plot(ctd, which=4)
plot(ctd, which=33)
```


### Plot echosounder objects

If you have data from an an echosounder in this format
```{r}
data(echosounder)
echosounder
```

```{r}
summary(echosounder)
```


the  would generate this plot:
```{r, fig.cap="3D contour plot of the echosounder."}
plot(echosounder, which = 2, drawTimeRange = TRUE, drawBottom = TRUE)
```

Echo sounding is a type of sonar used to determine the depth of water by transmitting sound waves into water. But echo sounding can also refer to hydroacoustic "echo sounders" defined as active sound in water (sonar) used to study e.g. fish (commonly applied in fisheries).

In this plot you clearly see the seafloor, which reflects the signal strongest (hence, the red color). The color scale for the amplitude is log10-transformed and trimmed to zero.

### Plot landsat objects

Landsat data can be downloaded from the [USGS earthexplorer](https://earthexplorer.usgs.gov/) website. The following is a subset of the Landsat-8 image designated LC80080292014065LGN00, an image from March 2014 that covers Nova Scotia and portions of the Bay of Fundy and the Scotian Shelf:

```{r}
data(landsat)
landsat
```

```{r, fig.cap="Image plot of the landsat data showing the temperature band."}
plot(landsat, band = "temperature")
```

Using `band = "temperature"` will plot an estimate of at-satellite brightness temperature, computed from the tirs1 band. Other band options for the Landsat-8 are `"aerosol"`, `"blue"`, `"green"`, `"red"`, `"nir"`, `"swir1"`, `"swir2"`, `"panchromatic"`, `"cirrus"`, `"tirs1"`, or `"tirs2"`.


### Plot coastline objects

*oce* provides a coastline dataset downloaded from [Natural Earth](http://www.naturalearthdata.com). This dataset has a coarse resolution with a scale of 1:110M and 10,696 points, making it more suitable for world-scale plots plotted at a small size. If you want coastline files with a finer resolution use the *ocedata* package.
```{r}
data(coastlineWorld)
coastlineWorld
```

```{r, fig.cap="Generic coastline plot with a Cartesian projection."}
plot(coastlineWorld)
```


If you want to create a map using a specific projection provided by the [rgdal]() package, which makes it easy to add more items such as points, lines, contours or text, use the function `mapPlot()`from *oce*. Here I will plot the trajectory of the Cook's Endeavour cruise (provided in the *ocedata* package) by adding the `mapPoints()` function:

```{r, fig.cap="Global map with the Mollweide projection (default)."}
# load the trajectory data 
data(endeavour, package = "ocedata")

par(mar = rep(0.5, 4)) # that removes the margin
mapPlot(coastlineWorld, type = 'l', col = 'gray', projection = "+proj=moll")
# to add points use mapPoint()
mapPoints(endeavour$longitude, endeavour$latitude, pch = 20, col = 'red')
```

You can also add some colors for the topography. The required data is in the dataset `topoWorld`:

```{r, fig.cap="Global map with added topography."}
data(topoWorld)
topo <- decimate(topoWorld, 2) # coarsen grid: 4X faster plot
lon <- topo[["longitude"]]
lat <- topo[["latitude"]]
z <- topo[["z"]]
cm <- colormap(name = "gmt_globe")
drawPalette(colormap = cm)
par(mar = rep(0.5, 4)) 
mapPlot(coastlineWorld, type = 'l', col = 'gray', projection = "+proj=moll", grid = FALSE)
mapImage(lon, lat, z, colormap = cm)
```

When zooming into mid-latitude, the Lambert Conformal Conic projection is often used:
```{r, fig.cap="Map of the North-Atlantic based on the Lambert Conformal Conic projection."}
par(mar = c(2, 2, 1, 1))
lonlim <- c(-80, 0)
latlim <- c(20, 60)
mapPlot(coastlineWorld, projection = "+proj=lcc +lat_1=30 +lat_2=50 +lon_0=-40",
        col = "lightgray", longitudelim = lonlim, latitudelim = latlim)
```

See the `?mapPlot` documentation on the different projections.


### Global sea surface and temperature levels in 2013 from the World Ocean Atlas (WOA)

The *ocedata* package has a dataset named `levitus`, which stores sea-surface temperature (SST) and salinity (SSS) from the 2013 version of the World Ocean Atlas (WOA), commonly referred to as the "Levitus"" atlas (package version 0.1.3):

```{r, fig.cap="Distribution of annual temperature (top) and salinity (bottom) levels in 2013 (original source WOA)."}
data(levitus, package = "ocedata")
par(mfrow = c(2,1))
imagep(levitus$longitude, levitus$latitude, levitus$SST, col = oceColorsJet, zlim = c(-2, 30))
imagep(levitus$longitude, levitus$latitude, levitus$SSS, col = oceColorsJet, zlim = c(20, 40))
```


### More infos

For more information on the different plotting settings see the general plot help by typing one of the different plot methods, e.g. `?plot,ctd-method`. Since the *oce* plot function produces various different type of plots, it is a bit tricky though to figure out which arguments are useful for which type of plot.

If you want to learn more about the package, I highly recommend the *oce* [vignette](https://cran.r-project.org/web/packages/oce/vignettes/oce.html) and the github documentation page: [https://cran.r-project.org/web/packages/oce/vignettes/oce.html](https://cran.r-project.org/web/packages/oce/vignettes/oce.html). Dan Kelly, the author of the package, also wrote the book [Oceanographic Analysis with R](https://www.springer.com/us/book/9781493988426) where the package is described in great detail.
